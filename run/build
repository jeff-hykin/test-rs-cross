#!/usr/bin/env bash
set -euo pipefail

DIST="$(dirname "$0")/../dist"
mkdir -p "$DIST"

build() {
    local target="$1"
    local name="$2"
    echo "Building $name..."
    out=$(nix build ".#$target" --no-link --print-out-paths 2>/dev/null | tail -1)
    cp "$out/bin/dimos" "$DIST/$name"
    echo "  -> dist/$name"
}

build macos-arm    dimos-aarch64-apple-darwin
build linux-x86    dimos-x86_64-linux-musl
build linux-arm64  dimos-aarch64-linux-musl

echo ""
echo "Done. Binaries in dist/:"
ls -lh "$DIST"
